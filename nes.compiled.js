'use strict';var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.makeIterator=function(a){$jscomp.initSymbolIterator();var b=a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};b.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var c=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){c(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(k){this.asyncThrow_(k)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var d=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(h){b.reject(h)}};d.prototype.createResolveAndReject_=function(){function a(a){return function(d){c||(c=!0,a.call(b,d))}}var b=this,c=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};d.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof d)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};d.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(h){this.reject_(h);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};d.prototype.reject_=function(a){this.settle_(2,a)};d.prototype.fulfill_=function(a){this.settle_(1,a)};d.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};d.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var e=new b;d.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};d.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(k){c.reject(k)}};d.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(b){try{e(a(b))}catch(p){f(p)}}:b}var e,f,g=new d(function(a,b){e=a;f=b});this.callWhenSettled_(c(a,e),
c(b,f));return g};d.prototype.catch=function(a){return this.then(void 0,a)};d.prototype.callWhenSettled_=function(a,b){function c(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?e.asyncExecute(c):this.onSettledCallbacks_.push(function(){e.asyncExecute(c)})};d.resolve=function(a){return a instanceof d?a:new d(function(b,c){b(a)})};d.reject=function(a){return new d(function(b,c){c(a)})};
d.race=function(a){return new d(function(b,c){for(var e=$jscomp.makeIterator(a),f=e.next();!f.done;f=e.next())d.resolve(f.value).callWhenSettled_(b,c)})};d.all=function(a){var b=$jscomp.makeIterator(a),c=b.next();return c.done?d.resolve([]):new d(function(a,e){function f(b){return function(c){g[b]=c;h--;0==h&&a(g)}}var g=[],h=0;do g.push(void 0),h++,d.resolve(c.value).callWhenSettled_(f(g.length-1),e),c=b.next();while(!c.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(d.$jscomp$new$AsyncExecutor=function(){return new b});
return d},"es6-impl","es3");$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(a){var b=$jscomp.checkStringArgs(this,null,"repeat");if(0>a||1342177279<a)throw new RangeError("Invalid count value");a|=0;for(var d="";a;)if(a&1&&(d+=b),a>>>=1)b+=b;return d}},"es6-impl","es3");var module$clock={};function Clock$$module$clock(a,b){var c=1/a;this.time=0;this.ntsc=b;this.cycleLength=c;this.tick=function(){this.time+=c}}Clock$$module$clock.ntsc=function(){return new Clock$$module$clock(1789773,!0)};
Clock$$module$clock.pal=function(){return new Clock$$module$clock(1662607,!1)};module$clock.default=Clock$$module$clock;var module$mem={},Memory$$module$mem=function(a){this.data8_=new Uint8Array(65536);this.callbacks_={};this.registers_={};this.log_=a?new MemLogger$$module$mem(a):null};Memory$$module$mem.prototype.zero=function(){this.data8_.fill(0)};Memory$$module$mem.prototype.get=function(a){return this.data8_[a]};Memory$$module$mem.prototype.getWord=function(a,b){var c=a+1&65535;b&&(c=c&b|a&~b);return this.data8_[a]|this.data8_[c]<<8};
Memory$$module$mem.prototype.set=function(a,b){a&0&&console.log("($"+a.toString(16)+") <- $"+b.toString(16));this.data8_[a]=b;this.call_(a,b)};Memory$$module$mem.prototype.setWord=function(a,b){this.set(a,b&255);this.set(a+1,b>>>8)};Memory$$module$mem.prototype.load=function(a,b){this.data8_.set(a,b)};Memory$$module$mem.prototype.call_=function(a,b){if(a=this.callbacks_[a]){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())c=c.value,c(b)}};
Memory$$module$mem.prototype.listen=function(a,b){(this.callbacks_[a]=this.callbacks_[a]||[]).push(b)};Memory$$module$mem.prototype.register=function(a,b){this.registers_[a]=b};
Memory$$module$mem.prototype.int=function(a,b,c,d){8<b&&(a+=b>>>3,b&=3);if(16<b+c)throw Error("two bytes max");var e=this,f=makeMask$$module$mem(c)<<b,g=255<f?this.getWord:this.get,h=255<f?this.setWord:this.set,k=function(){return(g.call(e,a)&f)>>>b},l=k();c={get:function(){return l},set:function(c){var d=g.call(e,a);h.call(d&~f|c<<b&f)}};var m=d&&this.log_?this.log_.add(c,d):function(){};this.listen(a,function(){l=k();m(l)});255<f&&this.listen(a+1,function(){l=k();m(l)});return c};
Memory$$module$mem.prototype.bool=function(a,b,c){var d=1<<b,e=this,f=!!(e.get(a)&d);b={get:function(){return f},set:function(b){b?e.set(a,e.get(a)|d):e.set(a,e.get(a)&~d)}};var g=c&&this.log_?this.log_.add(b,c):function(){};this.listen(a,function(){f=!!(e.get(a)&d);g(f)});return b};function makeMask$$module$mem(a){for(var b=0;a--;)b=b<<1|1;return b}Memory$$module$mem.Register=function(){};Memory$$module$mem.Register.prototype.get=function(){};Memory$$module$mem.Register.prototype.set=function(a){};
var MemLogger$$module$mem=function(a){this.clock=a;this.names=[];this.regs=[];this.changed=[];this.lastTime=Infinity;this.log=document.getElementById("memlog")};MemLogger$$module$mem.prototype.add=function(a,b){if(!this.log)return function(){};this.regs.push(a);this.names.push(b);return this.callback.bind(this,this.regs.length-1)};
MemLogger$$module$mem.prototype.callback=function(a,b){var c=this.clock.time;(a in this.changed&&this.changed[a]!=b||.01<c-this.lastTime)&&this.emit();this.changed[a]=b;this.lastTime=c};MemLogger$$module$mem.prototype.emit=function(){for(var a=[String(this.lastTime).substring(0,6)+"s"],b=0;b<this.regs.length;b++)a.push(this.names[b]+": "+Number(this.regs[b].get()));this.log.textContent+=a.join("\t")+"\n";this.changed=[]};module$mem.default=Memory$$module$mem;var module$apu$lengthcounter={},LengthCounter$$module$apu$lengthcounter=function(a,b){var c=this;this.enabled_=a.bool(16405,b>>>2&7);this.reload_=a.int(b+3,3,5,"lcr");this.counter_=1;this.disableCallback_=function(){};a.listen(16405,function(){c.enabled_.get()||c.disable()})};LengthCounter$$module$apu$lengthcounter.prototype.onDisable=function(a){this.disableCallback_=a};
LengthCounter$$module$apu$lengthcounter.prototype.clock=function(){0<this.counter_&&this.counter_--;!this.counter_&&this.enabled_.get()&&this.enabled_.set(!1)};LengthCounter$$module$apu$lengthcounter.prototype.start=function(){this.enabled_.get()&&(this.counter_=LengthCounter$$module$apu$lengthcounter.LENGTHS[this.reload_.get()])};LengthCounter$$module$apu$lengthcounter.prototype.disable=function(){this.counter_=0;this.disableCallback_()};
LengthCounter$$module$apu$lengthcounter.prototype.enabled=function(){return!!this.counter_};LengthCounter$$module$apu$lengthcounter.LENGTHS=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30];module$apu$lengthcounter.default=LengthCounter$$module$apu$lengthcounter;var module$apu$envelope={},Envelope$$module$apu$envelope=function(a,b){var c=this;this.volumeEnvelope_=a.int(b,0,4,"env");this.constantVolume_=a.bool(b,4,"-c");this.loopFlag_=a.bool(b,5,"-l");a.listen(b+0,function(){c.volume_=c.computeVolume_()});a.listen(b+3,function(){c.start_=!0;c.loopFlag_.get()||c.lengthCounter_.start()});this.start_=!1;this.volume_=this.counter_=this.divider_=0;this.lengthCounter_=new module$apu$lengthcounter.default(a,b)};
Envelope$$module$apu$envelope.prototype.print=function(){return"\n  volumeEnvelope="+this.volumeEnvelope_.get()+"\n  constantVolume="+this.constantVolume_.get()+"\n  loopFlag="+this.loopFlag_.get()};Envelope$$module$apu$envelope.prototype.clock=function(a){this.start_?(this.start_=!1,this.counter_=15,this.reloadDivider_()):this.clockDivider_();a&&!this.loopFlag_.get()&&(this.lengthCounter_.clock(),this.volume_=this.computeVolume_())};
Envelope$$module$apu$envelope.prototype.clockDivider_=function(){0==this.divider_?(0==this.counter_?this.loopFlag_.get()&&(this.counter_=15):this.counter_--,this.reloadDivider_()):this.divider_--};Envelope$$module$apu$envelope.prototype.reloadDivider_=function(){this.divider_=this.volumeEnvelope_.get();this.volume_=this.computeVolume_()};
Envelope$$module$apu$envelope.prototype.computeVolume_=function(){return this.loopFlag_.get()||this.lengthCounter_.enabled()?this.constantVolume_.get()?this.volumeEnvelope_.get():this.counter_:0};Envelope$$module$apu$envelope.prototype.volume=function(){return this.volume_};module$apu$envelope.default=Envelope$$module$apu$envelope;var module$apu$noise={},Noise$$module$apu$noise=function(a){a.bool(16405,3,"N");this.rate_=a.int(16398,0,4,"r");this.mode_=a.int(16398,7,"m");this.envelope_=new module$apu$envelope.default(a,16396);this.shiftDivider_=0;this.shiftRegister_=1;this.duty_=!1};Noise$$module$apu$noise.prototype.volume=function(){return this.duty_?this.envelope_.volume():0};Noise$$module$apu$noise.prototype.clockFrame=function(a){this.envelope_.clock(a%2)};
Noise$$module$apu$noise.prototype.clockSequencer=function(){if(0==this.shiftDivider_){var a=this.shiftRegister_&1^this.shiftRegister_>>>(this.mode_.get()?6:1)&1;this.shiftRegister_=this.shiftRegister_>>>1|a<<14;this.duty_=!!(this.shiftRegister_&1);this.shiftDivider_=TIMER_PERIOD_NTSC$$module$apu$noise[this.rate_.get()]}else this.shiftDivider_--};
var TIMER_PERIOD_NTSC$$module$apu$noise=[4,8,16,32,64,96,128,160,202,254,380,508,762,1016,2034,4068],TIMER_PERIOD_PAL$$module$apu$noise=[4,8,14,30,60,88,118,148,188,236,354,472,708,944,1890,3778];module$apu$noise.default=Noise$$module$apu$noise;var module$apu$pulse={},Pulse$$module$apu$pulse=function(a,b){var c=this;this.base_=b;var d=16384<b?2:1;a.bool(16405,d-1,"P"+d);this.dutyCycle_=a.int(b,6,2,"d");this.sweepEnabled_=a.bool(b,15,"sw");this.sweepShift_=a.int(b,8,3,"-sh");this.sweepNegate_=a.bool(b,11,"-n");this.sweepPeriod_=a.int(b,12,3,"-p");this.wavePeriod_=a.int(b,16,11,"p");this.envelope_=new module$apu$envelope.default(a,b);this.sweepDivider_=0;this.silenced_=this.sweepReload_=!1;this.sequenceDivider_=this.sequence_=0;this.duty_=
!1;a.listen(b+1,function(){c.sweepReload_=!0});a.listen(b+2,function(){c.duty_=c.computeDuty_()});a.listen(b+3,function(){c.sequence_=0;c.duty_=c.computeDuty_()})};Pulse$$module$apu$pulse.prototype.print=function(){};Pulse$$module$apu$pulse.prototype.computeDuty_=function(){return!(this.silenced_||8>this.wavePeriod_.get()||0==!DUTY_CYCLE_LIST$$module$apu$pulse[this.dutyCycle_.get()][this.sequence_])};Pulse$$module$apu$pulse.prototype.volume=function(){return this.duty_?this.envelope_.volume():0};
Pulse$$module$apu$pulse.prototype.clockFrame=function(a){if(0==this.sweepDivider_&&this.sweepEnabled_.get()){var b=this.sweepTarget_();2047<b||8>b?(this.silenced_=!0,this.duty_=!1):this.wavePeriod_.set(b)}else 0!=this.sweepDivider_&&this.sweepDivider_--;this.sweepReload_&&(this.sweepDivider_=this.sweepPeriod_.get(),this.silenced_=this.sweepReload_=!1);this.envelope_.clock(a%2);this.duty_=this.computeDuty_()};
Pulse$$module$apu$pulse.prototype.clockSequencer=function(){0==this.sequenceDivider_?(this.sequenceDivider_=this.wavePeriod_.get(),this.sequence_=(this.sequence_+1)%8,this.duty_=this.computeDuty_()):this.sequenceDivider_--};Pulse$$module$apu$pulse.prototype.sweepTarget_=function(){var a=this.wavePeriod_.get(),b=a>>>this.sweepShift_.get();this.sweepNegate_.get()&&(b=16384==this.base_?~b:-b);return a+b};
var Duty$$module$apu$pulse={EIGHTH:[0,1,0,0,0,0,0,0],QUARTER:[0,1,1,0,0,0,0,0],HALF:[0,1,1,1,1,0,0,0],THREE_QUARTERS:[1,0,0,1,1,1,1,1]},DUTY_CYCLE_LIST$$module$apu$pulse=[Duty$$module$apu$pulse.EIGHTH,Duty$$module$apu$pulse.QUARTER,Duty$$module$apu$pulse.HALF,Duty$$module$apu$pulse.THREE_QUARTERS];module$apu$pulse.default=Pulse$$module$apu$pulse;var module$apu$triangle={},Triangle$$module$apu$triangle=function(a){var b=this;a.bool(16405,2,"T");this.linearCounterReloadValue_=a.int(16392,0,7,"r");this.control_=a.bool(16392,7,"c");this.sequenceTimerPeriod_=a.int(16394,0,11,"p");this.volume_=0;this.lengthCounter_=new module$apu$lengthcounter.default(a,16392);this.linearCounterReloadFlag_=!1;this.sequence_=this.sequenceTimer_=this.linearCounter_=0;for(var c=16392;16396>c;c++)a.listen(c,function(){return b.print()});a.listen(16395,function(){return b.linearCounterReloadFlag_=
!0});this.lengthCounter_.onDisable(function(){return b.volume_=0})};Triangle$$module$apu$triangle.prototype.print=function(){};Triangle$$module$apu$triangle.prototype.volume=function(){return this.volume_};Triangle$$module$apu$triangle.prototype.computeVolume_=function(){return this.lengthCounter_.enabled()&&0<this.linearCounter_?WAVEFORM$$module$apu$triangle[this.sequence_]:0};
Triangle$$module$apu$triangle.prototype.clockFrame=function(a){this.linearCounterReloadFlag_?this.linearCounter_=this.linearCounterReloadValue_.get():0<this.linearCounter_&&(this.linearCounter_--,this.linearCounter_||(this.volume_=0));this.control_.get()&&(this.linearCounterReloadFlag_=!1);a%2&&!this.control_.get()&&this.lengthCounter_.clock()};
Triangle$$module$apu$triangle.prototype.clockSequencer=function(){0==this.sequenceTimer_?(this.sequence_=(this.sequence_+1)%32,this.sequenceTimer_=this.sequenceTimerPeriod_.get(),this.volume_=this.computeVolume_()):this.sequenceTimer_--};var WAVEFORM$$module$apu$triangle=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15];module$apu$triangle.default=Triangle$$module$apu$triangle;var module$apu$apu={},Enabler$$module$apu$apu=function(a){var b=this,c=document.getElementById(a);this.enabled=!0;c&&c.addEventListener("click",function(){b.enabled=c.checked;console.log(a+" => "+b.enabled)})},Apu$$module$apu$apu=function(a,b){this.mem_=a;this.clock_=b;this.pulse1_=new module$apu$pulse.default(a,16384);this.pulse2_=new module$apu$pulse.default(a,16388);this.triangle_=new module$apu$triangle.default(a);this.noise_=new module$apu$noise.default(a);this.steps_=[];this.last_=0;this.wait_=
2;this.frameCounter_=0;this.pulse1Enabled=new Enabler$$module$apu$apu("pulse1_enabled");this.pulse2Enabled=new Enabler$$module$apu$apu("pulse2_enabled");this.triangleEnabled=new Enabler$$module$apu$apu("triangle_enabled");this.noiseEnabled=new Enabler$$module$apu$apu("noise_enabled")};
Apu$$module$apu$apu.prototype.clock=function(){++this.frameCounter_==FRAME_LIMIT$$module$apu$apu&&(this.frameCounter_=0);null!=FRAME_CYCLES$$module$apu$apu[this.frameCounter_]&&(this.pulse1_.clockFrame(),this.pulse2_.clockFrame(),this.triangle_.clockFrame(),this.noise_.clockFrame());this.triangle_.clockSequencer();--this.wait_||(this.pulse1_.clockSequencer(),this.pulse2_.clockSequencer(),this.noise_.clockSequencer(),this.wait_=2);var a=this.volume();a!=this.last_&&(this.steps_.push([this.clock_.time,
a]),this.last_=a)};Apu$$module$apu$apu.prototype.steps=function(){var a=this.steps_,b=this.volume();a.push([this.clock_.time,b]);this.steps_=[[this.clock_.time,b]];return a};
Apu$$module$apu$apu.prototype.volume=function(){var a=this.pulse1Enabled.enabled?this.pulse1_.volume():0,b=this.pulse2Enabled.enabled?this.pulse2_.volume():0,a=(a||b)&&95.88/(8128/(a+b)+100),b=this.triangleEnabled.enabled?this.triangle_.volume():0,c=this.noiseEnabled.enabled?this.noise_.volume():0;return a+((b||c||0)&&159.79/(1/(b/8227+c/12241+0)+100))};
var $jscomp$compprop1={},FRAME_CYCLES$$module$apu$apu=($jscomp$compprop1[7457]=0,$jscomp$compprop1[14913]=1,$jscomp$compprop1[22371]=2,$jscomp$compprop1[29829]=3,$jscomp$compprop1),FRAME_LIMIT$$module$apu$apu=29830;module$apu$apu.default=Apu$$module$apu$apu;var module$audio$bufferedaudionode={},BufferedAudioNode$$module$audio$bufferedaudionode=function(a,b){this.fc_=(null!=b?b:2)*a.sampleRate;this.ac_=a;this.ab_=a.createBuffer(2,this.fc_,a.sampleRate);this.c0_=this.ab_.getChannelData(0);this.c1_=this.ab_.getChannelData(1);this.s_=a.createBufferSource();this.written_=0;this.underrun_=this.started_=-1;this.destination_=null;this.s_.buffer=this.ab_;this.s_.loop=!0;this.maxBuffer_=.9;this.minBuffer_=.5;this.writeResolver_=this.writePromise_=null;Object.seal(this)};
BufferedAudioNode$$module$audio$bufferedaudionode.prototype.connect=function(a){this.destination_=a;this.s_.connect(a)};BufferedAudioNode$$module$audio$bufferedaudionode.prototype.disconnect=function(){this.destination_=null;this.s_.disconnect()};
BufferedAudioNode$$module$audio$bufferedaudionode.prototype.reset=function(){this.writeResolver_&&this.writeResolver_();0<=this.started_&&this.s_.stop(0);this.s_.disconnect();this.s_=this.ac_.createBufferSource();this.written_=0;this.started_=-1;this.writePromise_=this.writeResolver_=null;this.s_.buffer=this.ab_;this.s_.loop=!0;this.s_.connect(this.ac_.destination)};
BufferedAudioNode$$module$audio$bufferedaudionode.prototype.buffer=function(){return 0>this.started_?0:Math.max(0,this.written_+this.started_-this.ac_.currentTime*this.ac_.sampleRate)/this.fc_};BufferedAudioNode$$module$audio$bufferedaudionode.prototype.bufferTime=function(){return 0>this.started_?Infinity:Math.max(0,(this.written_+this.started_)/this.ac_.sampleRate-this.ac_.currentTime)};
BufferedAudioNode$$module$audio$bufferedaudionode.prototype.bufferLimit=function(){var a=(this.maxBuffer_-this.buffer())*this.fc_;return Math.max(0,Math.floor(a))};
BufferedAudioNode$$module$audio$bufferedaudionode.prototype.write=function(a,b,c,d){var e=this;b=b||a;c=c||0;if(this.writePromise_!=d)return this.writePromise_=this.writePromise_.then(function(){return e.write(a,b,c,d)});var f=Math.max(a.length,b.length),g=Math.max(0,this.maxBuffer_-Math.max(0,this.buffer())),h=Math.floor(Math.min(f,c+g*this.fc_)),g=this.written_%this.fc_;if(c>h)throw Error("impossible "+c+" > "+h);0==this.written_&&c<h&&(this.s_.start(this.ac_.currentTime),this.started_=this.ac_.currentTime*
this.ac_.sampleRate);for(var k=c;k<h;k++)this.c0_[g]=k<a.length?a[k]:b[k],this.c1_[g]=k<b.length?b[k]:a[k],++g>=this.fc_&&(g=0);this.written_+=h-c;if(h<f)return this.writePromise_||(this.writePromise_=new Promise(function(a){return e.writeResolver_=a})),setTimeout(function(){e.write(a,b,h,e.writePromise_)},this.fc_/this.ac_.sampleRate*1E3*Math.max(this.maxBuffer_-this.minBuffer_,0)),this.writePromise_;this.writeResolver_&&(this.writeResolver_(),this.writeResolver_=this.writePromise_=null);for(var f=
this.buffer()*this.fc_,k=this.fc_-f,l=0;l<k;l++)this.c0_[g]=this.c1_[g]=0,++g>=this.fc_&&(g=0);var m=this.written_;clearTimeout(this.underrun_);this.underrun_=setTimeout(function(){e.written_==m&&e.reset()},(.9*k+f)/this.ac_.sampleRate*1E3);return Promise.resolve()};
$jscomp.global.Object.defineProperties(BufferedAudioNode$$module$audio$bufferedaudionode.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this.ac_}},numberOfInputs:{configurable:!0,enumerable:!0,get:function(){return 0}},numberOfOutputs:{configurable:!0,enumerable:!0,get:function(){return 1}},channelCount:{configurable:!0,enumerable:!0,get:function(){return 2}},channelCountMode:{configurable:!0,enumerable:!0,get:function(){return"explicit"}},channelInterpretation:{configurable:!0,
enumerable:!0,get:function(){return"speakers"}}});module$audio$bufferedaudionode.default=BufferedAudioNode$$module$audio$bufferedaudionode;var module$util$math={};
function cisi$$module$util$math(a){var b=Math.abs(a);if(!b)return new Complex$$module$util$math(-1.7E308);if(2<b){var c=new Complex$$module$util$math(1,b),d=new Complex$$module$util$math(1.7E308),e=c.inv(),f=e,g;for(g=1;100>g;g++){var h=-g*g,c=c.add(2),e=e.mul(h).add(c).inv(),d=c.add(d.inv().mul(h)),h=d.mul(e),f=f.mul(h);if(2.220446049250313E-16>=Math.abs(h.re-1)+Math.abs(h.im))break}if(100<=g)throw Error("cf failed in cisi("+a+")");f=(new Complex$$module$util$math(Math.cos(b),-Math.sin(b))).mul(f);
b=new Complex$$module$util$math(-f.re,f.im+1.570796326794897)}else{if(b<Math.sqrt(8.9E-308))d=0,e=b;else{c=e=d=0;g=f=1;var h=!0,k;for(k=1;100>=k;k++){g*=b/k;var l=g/k,c=c+f*l,l=l/Math.abs(c);h?(f=-f,e=c,c=d):(d=c,c=e);if(2.220446049250313E-16>l)break;h=!h}if(100<k)throw"maxits exceeded in cisi("+a+")";}b=new Complex$$module$util$math(d+Math.log(b)+.577215664901533,e)}0>a&&(b=b.conj());return b}var Complex$$module$util$math=function(a,b){this.re=a;this.im=void 0===b?0:b;Object.freeze(this)};
Complex$$module$util$math.prototype.add=function(a){return a instanceof Complex$$module$util$math?new Complex$$module$util$math(this.re+a.re,this.im+a.im):new Complex$$module$util$math(this.re+a,this.im)};Complex$$module$util$math.prototype.mul=function(a){return a instanceof Complex$$module$util$math?new Complex$$module$util$math(this.re*a.re-this.im*a.im,this.re*a.im+this.im*a.re):new Complex$$module$util$math(this.re*a,this.im*a)};
Complex$$module$util$math.prototype.sub=function(a){return a instanceof Complex$$module$util$math?new Complex$$module$util$math(this.re-a.re,this.im-a.im):new Complex$$module$util$math(this.re-a,this.im)};Complex$$module$util$math.prototype.inv=function(){var a=this.mag2();return new Complex$$module$util$math(this.re/a,-this.im/a)};
Complex$$module$util$math.prototype.div=function(a){return a instanceof Complex$$module$util$math?this.mul(a.conj()).div(a.mag2()):new Complex$$module$util$math(this.re/a,this.im/a)};Complex$$module$util$math.prototype.conj=function(){return new Complex$$module$util$math(this.re,-this.im)};Complex$$module$util$math.prototype.mag2=function(){return this.re*this.re+this.im*this.im};
Complex$$module$util$math.prototype.toString=function(){return 0==this.im?String(this.re):0<this.im?this.re+" + "+this.im+"i":this.re+" - "+-this.im+"i"};Complex$$module$util$math.ONE=new Complex$$module$util$math(1);Complex$$module$util$math.I=new Complex$$module$util$math(0,1);Complex$$module$util$math.ZERO=new Complex$$module$util$math(0);Object.freeze(Complex$$module$util$math);module$util$math.cisi=cisi$$module$util$math;module$util$math.Complex=Complex$$module$util$math;var module$util$util={};function nub$$module$util$util(a){if(!a.length)return[];var b=[a[0]];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next())c=c.value,c!=b[b.length-1]&&b.push(c);return b}module$util$util.nub=nub$$module$util$util;var module$audio$kernel={},StepKernel$$module$audio$kernel=function(a){this.data_=a;var b=module$util$util.nub(a.map(function(a){return a.length}));if(1!=b.length)throw Error("non-rectangular array");this.radius_=b[0]/2;this.phases_=2*(a.length-1)};
StepKernel$$module$audio$kernel.prototype.convolve=function(a,b,c){b=new Float32Array(b-a);c=$jscomp.makeIterator(c);for(var d=c.next();!d.done;d=c.next()){var e=d.value,d=e[1],f=Math.round(e[0]),g=Math.round((e[0]-f)*this.phases_),e=this.data_[Math.abs(g)];0>g&&(e=e.slice().reverse());f=f-a-e.length/2;for(g=Math.max(0,-f);g<Math.min(e.length,b.length-f);g++)b[f+g]+=e[g]*d}return b};
$jscomp.global.Object.defineProperties(StepKernel$$module$audio$kernel.prototype,{radius:{configurable:!0,enumerable:!0,get:function(){return this.radius_}}});
function lanczosKernel$$module$audio$kernel(a,b){function c(a){if(0==a)return 0;if(a>=d)return.5;if(a<=-d)return-.5;var b=(d-1)*e*a,c=(d+1)*e*a;return(-b*module$util$math.cisi(b/d).im+c*module$util$math.cisi(c/d).im-2*d*Math.sin(e*a)*Math.sin(e*a/d))/(2*e*e*a)}b-=b%2;var d=2*(a>>>0)-1,e=Math.PI,f=c(d)-c(-d);a=[];for(var g=0;g<=b;g+=2)a.push(g/b);var h=[];for(b=-d-1;b<=d+1;b+=2)h.push(b);b=a.map(function(a){return h.map(function(b){return b-a})}).map(function(a){return a.map(function(a){return c(a)/
f+.5})});return new StepKernel$$module$audio$kernel(b.map(function(a){for(var b=Array(a.length-1),c=1;c<a.length;c++)b[c-1]=a[c]-a[c-1];return b}))}module$audio$kernel.StepKernel=StepKernel$$module$audio$kernel;module$audio$kernel.lanczosKernel=lanczosKernel$$module$audio$kernel;var module$audio$stepbufferwriter={},StepBufferWriter$$module$audio$stepbufferwriter=function(a){this.buffer_=a;this.sampleRate_=a.context.sampleRate;this.lastSample_=this.lastStep_=this.sampleIndex_=0;this.steps_=[];this.kernel_=module$audio$kernel.lanczosKernel(5,32)};
StepBufferWriter$$module$audio$stepbufferwriter.prototype.write=function(a){if(!a.length)return new Promise(function(a){return setTimeout(a,50)});var b=[];a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){var d=c.value,c=d[0]*this.sampleRate_,e=d[1]-this.lastStep_;this.lastStep_=d[1];if(c<=this.sampleIndex_)this.lastStep_=this.lastSample_=d[1],this.steps_=[],console.log("past value: resetting");else{d=Math.floor(c-this.kernel_.radius);if(d>this.sampleIndex_){for(var f=this.kernel_.convolve(this.sampleIndex_,
d,this.steps_),f=$jscomp.makeIterator(f),g=f.next();!g.done;g=f.next())b.push(this.lastSample_+=g.value);this.sampleIndex_=d;d=Math.floor(this.sampleIndex_-this.kernel_.radius);for(f=0;f<this.steps_.length&&this.steps_[f][0]<d;)f++;0<f&&this.steps_.splice(0,f)}this.steps_.push([c,e])}}return this.buffer_.write(b)};module$audio$stepbufferwriter.default=StepBufferWriter$$module$audio$stepbufferwriter;var module$bankswitcher={},BankSwitcher$$module$bankswitcher=function(a,b){var c=this;this.mem_=a;this.pages_=[];var d={};for(d.i=b?6:8;16>d.i;d={i:d.i},d.i++)a.listen(24560+d.i,function(a){return function(b){return c.swap_(a.i,b)}}(d))};
BankSwitcher$$module$bankswitcher.prototype.load=function(a,b){b&=4095;var c=b+a.length;c&4095&&(c=(c&-4096)+4096);var d;a.length<c?(d=new Uint8Array(c),d.set(a,b)):d=a;for(b=0;b<c>>>12;b++)this.pages_[b]=new Uint8Array(d.buffer,b<<12,4096);console.log("Loaded "+this.pages_.length+" pages from "+a.length)};
BankSwitcher$$module$bankswitcher.prototype.swap_=function(a,b){console.log("BANK SWITCH: "+a+" <= "+b);if(this.pages_.length){if(b>=this.pages_.length)throw Error("invalid bank index");this.mem_.load(this.pages_[b],(a&15)<<12);console.log("  ==> done")}};$jscomp.global.Object.defineProperties(BankSwitcher$$module$bankswitcher.prototype,{pages:{configurable:!0,enumerable:!0,get:function(){return this.pages_.length}}});module$bankswitcher.default=BankSwitcher$$module$bankswitcher;var module$cpu={},Cpu$$module$cpu=function(a){var b=this;this.mem_=a;this.S=this.V=this.B=this.D=this.I=this.Z=this.C=!1;this.Y=this.X=this.A=0;this.SP=511;this.PC=0;this.operand=this.opcode=null;this.wait=1;this.opcodes_=instructionTable$$module$cpu();var c=document.getElementById("log"),d=[],e=0;a=function(){};this.log=c?function(a){d.push(a);e+=a.length;1E3<e&&(c.textContent+=d.join(""),e=0,d=[])}:a;this.line=this.log!=a?function(a){return b.log("\t"+a())}:a};
Cpu$$module$cpu.prototype.init=function(){this.C=this.Z=this.I=this.D=this.B=this.V=this.S=!1;this.A=this.X=this.Y=this.PC=0;this.SP=511;this.opcode=this.operand=null;this.wait=1};Cpu$$module$cpu.prototype.clock=function(){this.opcode||this.loadOp();1<--this.wait||!this.opcode||(this.opcode.op.call(this),this.opcode.extraCycles||(this.wait=0),this.opcode=null)};
Cpu$$module$cpu.prototype.loadOp=function(){this.opcode=this.opcodes_[this.mem_.get(++this.PC)];for(var a=this.operand=0,b=this.opcode.mode.bytes;0<b;b--)this.operand|=this.mem_.get(++this.PC)<<(a+=8)-8;this.opcode.mode.signed&&127<this.operand&&(this.operand-=256);this.wait+=this.opcode.cycles;a=hex$$module$cpu(this.PC-this.opcode.mode.bytes,2);this.log("\n"+a+": "+this.opcode.format(this.operand))};
Cpu$$module$cpu.prototype.disassemble=function(a,b){for(this.PC=--a;0<b--;){this.loadOp();for(var c="\t";a<this.PC;)c+=hex$$module$cpu(this.mem_.get(++a)).substring(1)+" ";this.log(c)}};Cpu$$module$cpu.prototype.accumulator=function(){return null};Cpu$$module$cpu.prototype.absolute=function(){return this.operand};Cpu$$module$cpu.prototype.absoluteX=function(){return this.checkCross_(this.operand,this.X)};Cpu$$module$cpu.prototype.absoluteY=function(){return this.checkCross_(this.operand,this.Y)};
Cpu$$module$cpu.prototype.immediate=function(){return~this.operand};Cpu$$module$cpu.prototype.implied=function(){throw Error("Implied opcode has no operand.");};Cpu$$module$cpu.prototype.indirect=function(){return this.mem_.getWord(this.operand,4095)};Cpu$$module$cpu.prototype.indirectX=function(){return this.mem_.getWord(255&this.operand+this.X,255)};Cpu$$module$cpu.prototype.indirectY=function(){return this.checkCross_(this.mem_.getWord(this.operand),this.Y)};
Cpu$$module$cpu.prototype.relative=function(){return this.PC+this.operand};Cpu$$module$cpu.prototype.zeroPage=function(){return this.operand&255};Cpu$$module$cpu.prototype.zeroPageX=function(){return this.operand+this.X&255};Cpu$$module$cpu.prototype.zeroPageY=function(){return this.operand+this.Y&255};Cpu$$module$cpu.prototype.KIL=function(){throw Error("Illegal opcode: "+this.opcode.name);};Cpu$$module$cpu.prototype.LDA=function(){this.A=this.eqFlags_(this.M)};
Cpu$$module$cpu.prototype.LDX=function(){this.X=this.eqFlags_(this.M)};Cpu$$module$cpu.prototype.LDY=function(){this.Y=this.eqFlags_(this.M)};Cpu$$module$cpu.prototype.STA=function(){this.M=this.A};Cpu$$module$cpu.prototype.STX=function(){this.M=this.X};Cpu$$module$cpu.prototype.STY=function(){this.M=this.Y};
Cpu$$module$cpu.prototype.ADC=function(){if(this.D)throw Error("BCD not supported!");var a=this.M,b=this.A+a+this.C,c=this.A&128;this.V=c==(a&128)&&c!=(b&128)||this.C&&128==b;this.C=255<b;this.A=this.eqFlags_(b&255)};Cpu$$module$cpu.prototype.SBC=function(){if(this.D)throw Error("BCD not supported!");var a=this.M,b=this.A-a-!this.C,c=this.A&128;this.V=c!=(a&128)&&c!=(b&128)||!this.C&&-129==b;this.C=0>b;this.A=this.eqFlags_(b&255)};Cpu$$module$cpu.prototype.INC=function(){this.eqFlags_(++this.M)};
Cpu$$module$cpu.prototype.INX=function(){this.eqFlags_(++this.X)};Cpu$$module$cpu.prototype.INY=function(){this.eqFlags_(++this.Y)};Cpu$$module$cpu.prototype.DEC=function(){this.eqFlags_(--this.M)};Cpu$$module$cpu.prototype.DEX=function(){this.eqFlags_(--this.X)};Cpu$$module$cpu.prototype.DEY=function(){this.eqFlags_(--this.Y)};Cpu$$module$cpu.prototype.ASL=function(){var a=this.M<<1;this.C=255<a;this.M=this.eqFlags_(a&255)};
Cpu$$module$cpu.prototype.LSR=function(){var a=this.M;this.C=a&1;this.M=this.eqFlags_(a>>>1)};Cpu$$module$cpu.prototype.ROL=function(){var a=this.M<<1|this.C;this.C=255<a;this.M=this.eqFlags_(a&255)};Cpu$$module$cpu.prototype.ROR=function(){var a=this.M|(this.C?256:0);this.C=a&1;this.M=this.eqFlags_(a>>>1)};Cpu$$module$cpu.prototype.AND=function(){this.A=this.eqFlags_(this.M&this.A)};Cpu$$module$cpu.prototype.ORA=function(){this.A=this.eqFlags_(this.M|this.A)};
Cpu$$module$cpu.prototype.EOR=function(){this.A=this.eqFlags_(this.M^this.A)};Cpu$$module$cpu.prototype.CMP=function(){this.cmpFlags_(this.A,this.M)};Cpu$$module$cpu.prototype.CPX=function(){this.cmpFlags_(this.X,this.M)};Cpu$$module$cpu.prototype.CPY=function(){this.cmpFlags_(this.Y,this.M)};Cpu$$module$cpu.prototype.BIT=function(){var a=this.M;this.S=a&128;this.V=a&64;this.Z=!(this.A&a)};Cpu$$module$cpu.prototype.BCC=function(){this.C||(this.PC=this.checkBranch_(this.MP))};
Cpu$$module$cpu.prototype.BCS=function(){this.C&&(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.BEQ=function(){this.Z&&(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.BNE=function(){this.Z||(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.BMI=function(){this.S&&(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.BPL=function(){this.S||(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.BVC=function(){this.V||(this.PC=this.checkBranch_(this.MP))};
Cpu$$module$cpu.prototype.BVS=function(){this.V&&(this.PC=this.checkBranch_(this.MP))};Cpu$$module$cpu.prototype.TAX=function(){this.X=this.eqFlags_(this.A)};Cpu$$module$cpu.prototype.TXA=function(){this.A=this.eqFlags_(this.X)};Cpu$$module$cpu.prototype.TAY=function(){this.Y=this.eqFlags_(this.A)};Cpu$$module$cpu.prototype.TYA=function(){this.A=this.eqFlags_(this.Y)};Cpu$$module$cpu.prototype.TSX=function(){this.X=this.eqFlags_(this.SP)};Cpu$$module$cpu.prototype.TXS=function(){this.SP=this.eqFlags_(this.X)};
Cpu$$module$cpu.prototype.PHA=function(){this.pushByte(this.A)};Cpu$$module$cpu.prototype.PLA=function(){this.A=this.pullByte()};Cpu$$module$cpu.prototype.PHP=function(){this.pushByte(this.SR)};Cpu$$module$cpu.prototype.PLP=function(){this.SR=this.pullByte()};Cpu$$module$cpu.prototype.JMP=function(){this.PC=this.MP-1};Cpu$$module$cpu.prototype.JSR=function(){this.pushWord(this.PC);this.PC=this.MP-1};
Cpu$$module$cpu.prototype.RTS=function(){var a=this;this.PC=this.pullWord();this.line(function(){return"PC="+hex$$module$cpu(a.PC)})};Cpu$$module$cpu.prototype.RTI=function(){this.SR=this.pullByte();this.PC=this.pullWord()-1};Cpu$$module$cpu.prototype.SEC=function(){this.C=1};Cpu$$module$cpu.prototype.SED=function(){this.D=1};Cpu$$module$cpu.prototype.SEI=function(){this.I=1};Cpu$$module$cpu.prototype.CLC=function(){this.C=0};Cpu$$module$cpu.prototype.CLD=function(){this.D=0};
Cpu$$module$cpu.prototype.CLI=function(){this.I=0};Cpu$$module$cpu.prototype.CLV=function(){this.V=0};Cpu$$module$cpu.prototype.NOP=function(){};Cpu$$module$cpu.prototype.BRK=function(){this.B=this.I=1;if(!this.mem_.getWord(this.PC)&&!this.mem_.getWord(this.PC+2))throw Error("Executing zeros!");};Cpu$$module$cpu.prototype.pushByte=function(a){var b=this;this.mem_.set(this.SP--,a);this.line(function(){return"(SP)="+hex$$module$cpu(a)+", SP="+hex$$module$cpu(b.SP,2)})};
Cpu$$module$cpu.prototype.pushWord=function(a){var b=this;this.mem_.setWord(this.SP-1,a);this.SP-=2;this.line(function(){return"(SP)="+hex$$module$cpu(a,2)+", SP="+hex$$module$cpu(b.SP,2)})};Cpu$$module$cpu.prototype.pullByte=function(a){var b=this,c=this.mem_.get(++this.SP);this.line(function(){return hex$$module$cpu(c)+"<-(SP), SP="+hex$$module$cpu(b.SP,2)});return c};
Cpu$$module$cpu.prototype.pullWord=function(a){var b=this,c=this.mem_.getWord((this.SP+=2)-1);this.line(function(){return hex$$module$cpu(c,2)+"<-(SP), SP="+hex$$module$cpu(b.SP,2)});return c};Cpu$$module$cpu.prototype.eqFlags_=function(a){this.S=a&128;this.Z=!a;return a};Cpu$$module$cpu.prototype.cmpFlags_=function(a,b){var c=this;this.C=!(this.S=a<b);this.Z=a==b;this.line(function(){return"R="+hex$$module$cpu(a)+", M="+hex$$module$cpu(b)+", C="+(c.C?1:0)+", S="+(c.S?1:0)+", Z="+(c.Z?1:0)})};
Cpu$$module$cpu.prototype.checkBranch_=function(a){var b=this;this.line(function(){return"PC="+hex$$module$cpu(b.PC,2)+"->"+hex$$module$cpu(a,2)});this.wait=(this.PC&61440)==(a&61440)?1:2;return a};Cpu$$module$cpu.prototype.checkCross_=function(a,b){b=a+b;b&65280!=a&65280&&(this.wait+=1);return b};
$jscomp.global.Object.defineProperties(Cpu$$module$cpu.prototype,{SR:{configurable:!0,enumerable:!0,get:function(){var a;a=0|(this.S?128:0);a|=this.V?64:0;a|=this.B?16:0;a|=this.D?8:0;a|=this.I?4:0;a|=this.Z?2:0;return a|=this.C?1:0},set:function(a){this.S=!!(a&128);this.V=!!(a&64);this.B=!!(a&16);this.D=!!(a&8);this.I=!!(a&4);this.Z=!!(a&2);this.C=!!(a&1)}},MP:{configurable:!0,enumerable:!0,get:function(){var a=this.opcode.mode.func.call(this);if(null==a||0>a)throw Error("Jump to non-address.");
return a}},M:{configurable:!0,enumerable:!0,get:function(){var a=this.opcode.mode.func.call(this);return null==a?this.A:0>a?~a:this.mem_.get(a)},set:function(a){var b=this.opcode.mode.func.call(this);if(0>b)throw Error("Cannot write to immediate value.");null==b?(this.A=a,this.line(function(){return"A="+hex$$module$cpu(a)})):(this.mem_.set(b,a),this.line(function(){return"("+hex$$module$cpu(b,2)+")="+hex$$module$cpu(a)}))}}});
var AddressingMode$$module$cpu=function(a,b){var c=this;this.fmt=a;this.bytes=/\$\$/.test(a)?2:/\$/.test(a)?1:0;this.func=b;this.signed=/\+\$/.test(a);var d=a.replace(/\+?\$\$?.*/,""),e=a.replace(/.*\+?\$\$?/,"");this.format=this.bytes?function(a){return""+d+hex$$module$cpu(a,c.bytes,c.signed)+e}:function(b){return a}},Opcode$$module$cpu=function(a,b,c,d,e){this.name=a;this.mode=b;this.op=c;this.cycles=d;this.extraCycles=e};Opcode$$module$cpu.prototype.format=function(a){return this.name+" "+this.mode.format(a)};
Opcode$$module$cpu.prototype.toString=function(){return this.name+" "+this.mode.fmt};
function instructionTable$$module$cpu(){function a(a,b){e[a]=b}function b(a,b){d[a]=new AddressingMode$$module$cpu(a,b)}function c(a,b){if(!a||!b)throw Error("bad reference");return function(){a.call(this);b.call(this)}}var d={},e={};e.LDA=Cpu$$module$cpu.prototype.LDA;e.LDX=Cpu$$module$cpu.prototype.LDX;e.LDY=Cpu$$module$cpu.prototype.LDY;e.STA=Cpu$$module$cpu.prototype.STA;e.STX=Cpu$$module$cpu.prototype.STX;e.STY=Cpu$$module$cpu.prototype.STY;e.ADC=Cpu$$module$cpu.prototype.ADC;e.SBC=Cpu$$module$cpu.prototype.SBC;
e.INC=Cpu$$module$cpu.prototype.INC;e.INX=Cpu$$module$cpu.prototype.INX;e.INY=Cpu$$module$cpu.prototype.INY;e.DEC=Cpu$$module$cpu.prototype.DEC;e.DEX=Cpu$$module$cpu.prototype.DEX;e.DEY=Cpu$$module$cpu.prototype.DEY;e.ASL=Cpu$$module$cpu.prototype.ASL;e.LSR=Cpu$$module$cpu.prototype.LSR;e.ROL=Cpu$$module$cpu.prototype.ROL;e.ROR=Cpu$$module$cpu.prototype.ROR;e.AND=Cpu$$module$cpu.prototype.AND;e.ORA=Cpu$$module$cpu.prototype.ORA;e.EOR=Cpu$$module$cpu.prototype.EOR;e.CMP=Cpu$$module$cpu.prototype.CMP;
e.CPX=Cpu$$module$cpu.prototype.CPX;e.CPY=Cpu$$module$cpu.prototype.CPY;e.BIT=Cpu$$module$cpu.prototype.BIT;e.BCC=Cpu$$module$cpu.prototype.BCC;e.BCS=Cpu$$module$cpu.prototype.BCS;e.BEQ=Cpu$$module$cpu.prototype.BEQ;e.BMI=Cpu$$module$cpu.prototype.BMI;e.BNE=Cpu$$module$cpu.prototype.BNE;e.BPL=Cpu$$module$cpu.prototype.BPL;e.BVC=Cpu$$module$cpu.prototype.BVC;e.BVS=Cpu$$module$cpu.prototype.BVS;e.TAX=Cpu$$module$cpu.prototype.TAX;e.TXA=Cpu$$module$cpu.prototype.TXA;e.TAY=Cpu$$module$cpu.prototype.TAY;
e.TYA=Cpu$$module$cpu.prototype.TYA;e.TSX=Cpu$$module$cpu.prototype.TSX;e.TXS=Cpu$$module$cpu.prototype.TXS;e.PHA=Cpu$$module$cpu.prototype.PHA;e.PLA=Cpu$$module$cpu.prototype.PLA;e.PHP=Cpu$$module$cpu.prototype.PHP;e.PLP=Cpu$$module$cpu.prototype.PLP;e.JMP=Cpu$$module$cpu.prototype.JMP;e.JSR=Cpu$$module$cpu.prototype.JSR;e.RTS=Cpu$$module$cpu.prototype.RTS;e.RTI=Cpu$$module$cpu.prototype.RTI;e.SEC=Cpu$$module$cpu.prototype.SEC;e.SED=Cpu$$module$cpu.prototype.SED;e.SEI=Cpu$$module$cpu.prototype.SEI;
e.CLC=Cpu$$module$cpu.prototype.CLC;e.CLD=Cpu$$module$cpu.prototype.CLD;e.CLI=Cpu$$module$cpu.prototype.CLI;e.CLV=Cpu$$module$cpu.prototype.CLV;e.NOP=Cpu$$module$cpu.prototype.NOP;e.BRK=Cpu$$module$cpu.prototype.BRK;e.KIL=Cpu$$module$cpu.prototype.KIL;a("SLO",c(Cpu$$module$cpu.prototype.ASL,Cpu$$module$cpu.prototype.ORA));a("XAA",c(Cpu$$module$cpu.prototype.TXA,Cpu$$module$cpu.prototype.AND));a("RLA",c(Cpu$$module$cpu.prototype.ROL,Cpu$$module$cpu.prototype.AND));b("A",Cpu$$module$cpu.prototype.accumulator);
b("$$",Cpu$$module$cpu.prototype.absolute);b("$$,X",Cpu$$module$cpu.prototype.absoluteX);b("$$,Y",Cpu$$module$cpu.prototype.absoluteY);b("#$",Cpu$$module$cpu.prototype.immediate);b("",Cpu$$module$cpu.prototype.implied);b("($$)",Cpu$$module$cpu.prototype.indirect);b("($,X)",Cpu$$module$cpu.prototype.indirectX);b("($),Y",Cpu$$module$cpu.prototype.indirectY);b("+$",Cpu$$module$cpu.prototype.relative);b("$",Cpu$$module$cpu.prototype.zeroPage);b("$,X",Cpu$$module$cpu.prototype.zeroPageX);b("$,Y",Cpu$$module$cpu.prototype.zeroPageY);
var f=";    00: BRK 7          | ORA ($,X) 6    | KIL!           | SLO! ($,X) 8;    04: NOP! $ 3       | ORA $ 3        | ASL $ 5        | SLO! $ 5;    08: PHP 3          | ORA #$ 2       | ASL A 2        | ANC! #$ 2;    0C: NOP! $$ 4      | ORA $$ 4       | ASL $$ 6       | SLO! $$ 6;;    10: BPL +$ 2+      | ORA ($),Y 5+   | KIL!           | SLO! ($),Y 8;    14: NOP! $,X 4     | ORA $,X 4      | ASL $,X 6      | SLO! $,X 6;    18: CLC 2          | ORA $$,Y 4+    | NOP! A 2       | SLO! $$,Y 7;    1C: NOP! $$,X 4+   | ORA $$,X 4+    | ASL $$,X 7     | SLO! $$,X 7;;    20: JSR $$ 6       | AND ($,X) 6    | KIL!           | RLA! ($,X) 8;    24: BIT $ 3        | AND $ 3        | ROL $ 5        | RLA! $ 5;    28: PLP 4          | AND #$ 2       | ROL A 2        | ANC! #$ 2;    2C: BIT $$ 4       | AND $$ 4       | ROL $$ 6       | RLA! $$ 6;;    30: BMI +$ 2+      | AND ($),Y 5+   | KIL!           | RLA! ($),Y 8;    34: NOP! $,X 4     | AND $,X 4      | ROL $,X 6      | RLA! $,X 6;    38: SEC 2          | AND $$,Y 4+    | NOP! A 2       | RLA! $$,Y 7;    3C: NOP $$,X 4+    | AND $$,X 4+    | ROL $$,X 7     | RLA! $$,X 7;;    40: RTI 6          | EOR ($,X) 6    | KIL!           | SRE! ($,X) 8;    44: NOP! $ 3       | EOR $ 3        | LSR $ 5        | SRE! $ 5;    48: PHA 3          | EOR #$ 2       | LSR A 2        | ALR! #$ 2;    4C: JMP $$ 3       | EOR $$ 4       | LSR $$ 6       | SRE! $$ 6;;    50: BVC +$ 2+      | EOR ($),Y 5+   | KIL!           | SRE! ($),Y 8;    54: NOP! $,X 4     | EOR $,X 4      | LSR $,X 6      | SRE! $,X 6;    58: CLI 2          | EOR $$,Y 4+    | NOP! A 2       | SRE! $$,Y 7;    5C: NOP! $$,X 4+   | EOR $$,X 4+    | LSR $$,X 7     | SRE! $$,X 7;;    60: RTS 6          | ADC ($,X) 6    | KIL!           | RRA! ($,X) 8;    64: NOP! $ 3       | ADC $ 3        | ROR $ 5        | RRA! $ 5;    68: PLA 4          | ADC #$ 2       | ROR A 2        | ARR! #$ 2;    6C: JMP ($$) 5     | ADC $$ 4       | ROR $$ 6       | RRA! $$ 6;;    70: BVS +$ 2+      | ADC ($),Y 5+   | KIL!           | RRA! ($),Y 8;    74: NOP! $,X 4     | ADC $,X 4      | ROR $,X 6      | RRA! $,X 6;    78: SEI 2          | ADC $$,Y 4+    | NOP! A 2       | RRA! $$,Y 7;    7C: NOP! $$,X 4+   | ADC $$,X 4+    | ROR $$,X 7     | RRA! $$,X 7;;    80: NOP! #$ 2      | STA ($,X) 6    | NOP! #$ 2      | SAX! ($,X) 6;    84: STY $ 3        | STA $ 3        | STX $ 3        | SAX! $ 3;    88: DEY 2          | NOP! #$ 2      | TXA 2          | XAA!! #$ 2;    8C: STY $$ 4       | STA $$ 4       | STX $$ 4       | SAX! $$ 4;;    90: BCC +$ 2+      | STA ($),Y 6    | KIL!           | AHX!! ($),Y 6;    94: STY $,X 4      | STA $,X 4      | STX $,Y 4      | SAX! $,Y 4;    98: TYA 2          | STA $$,Y 5     | TXS 2          | TAS!! $$,Y 5;    9C: SHY!! $$,X 5   | STA $$,X 5     | SHX!! $$,Y 5   | AHX!! $$,Y 5;;    A0: LDY #$ 2       | LDA ($,X) 6    | LDX #$ 2       | LAX! ($,X) 6;    A4: LDY $ 3        | LDA $ 3        | LDX $ 3        | LAX! $ 3;    A8: TAY 2          | LDA #$ 2       | TAX 2          | LAX!! #$ 2;    AC: LDY $$ 4       | LDA $$ 4       | LDX $$ 4       | LAX! $$ 4;;    B0: BCS +$ 2+      | LDA ($),Y 5+   | KIL!           | LAX! ($),Y 5+;    B4: LDY $,X 4      | LDA $,X 4      | LDX $,Y 4      | LAX! $,Y 4;    B8: CLV 2          | LDA $$,Y 4+    | TSX 2          | LAS! $$,Y 4+;    BC: LDY $$,X 4+    | LDA $$,X 4+    | LDX $$,Y 4+    | LAX! $$,Y 4+;;    C0: CPY #$ 2       | CMP ($,X) 6    | NOP! #$ 2      | DCP! ($,X) 8;    C4: CPY $ 3        | CMP $ 3        | DEC $ 5        | DCP! $ 5;    C8: INY 2          | CMP #$ 2       | DEX 2          | AXS! #$ 2;    CC: CPY $$ 4       | CMP $$ 4       | DEC $$ 6       | DCP! $$ 6;;    D0: BNE +$ 2+      | CMP ($),Y 5+   | KIL!           | DCP! ($),Y 8;    D4: NOP! $,X 4     | CMP $,X 4      | DEC $,X 6      | DCP! $,X 6;    D8: CLD 2          | CMP $$,Y 4+    | NOP! 2         | DCP! $$,Y 7;    DC: NOP! $$,X 4+   | CMP $$,X 4+    | DEC $$,X 7     | DCP! $$,X 7;;    E0: CPX #$ 2       | SBC ($,X) 6    | NOP! #$ 2      | ISC! ($,X) 8;    E4: CPX $ 3        | SBC $ 3        | INC $ 5        | ISC! $ 5;    E8: INX 2          | SBC #$ 2       | NOP 2          | SBC! #$ 2;    EC: CPX $$ 4       | SBC $$ 4       | INC $$ 6       | ISC! $$ 6;;    F0: BEQ +$ 2+      | SBC ($),Y 5+   | KIL!           | ISC! ($),Y 8;    F4: NOP! $,X 4     | SBC $,X 4      | INC $,X 6      | ISC! $,X 6;    F8: SED 2          | SBC $$,Y 4+    | NOP! 2         | ISC! $$,Y 7;    FC: NOP! $$,X 4+   | SBC $$,X 4+    | INC $$,X 7     | ISC! $$,X 7".split(";").map(function(a){return a.replace(/^\s*[0-9A-F]{2}:\s*/,
"").split("|")}).reduce(function(a,b){return a.concat(b)},[]).map(function(a){return a.trim()}).filter(function(a){return a}).map(function(a){var b=a.split(" "),c=d[2<b.length?b[1]:""];if(!c)throw Error("Unknown mode: "+a);var f=1<b.length?b[b.length-1]:"1",g=!1;"!"==b[0][3]&&(b[0]=b[0].replace("!",""),b[0]=b[0].replace("!",""),g=!0);var n=e[b[0]];if(!n)if(g)n=e.KIL;else throw Error("Unknown op: "+a);return new Opcode$$module$cpu(b[0],c,n,Number.parseInt(f.replace("+",""),10),/\+/.test(f))});if(256!=
f.length)throw new Exception("wrong number of opcodes: "+f.join("|"));return f}function hex$$module$cpu(a,b,c){b=void 0===b?1:b;c=void 0===c?!1:c;if(null==a)return window.msg=!0,setTimeout(function(){throw"NULL number";},0),"NUL";var d="";c&&(d="+",0>a&&(d="-",a=-a));for(a=a.toString(16).toUpperCase();a.length<2*b;)a="0000".substring(0,2*b-a.length)+a;return d+"$"+a}module$cpu.default=Cpu$$module$cpu;var module$nsf={};function getString$$module$nsf(a,b,c){for(var d=[],e=0;e<c;e++){var f=a.getUint8(b+e);if(!f)break;d.push(f)}return String.fromCharCode.apply(String,[].concat($jscomp.arrayFromIterable(d)))}function readBits$$module$nsf(a,b){for(var c=[],d=1;d<arguments.length;++d)c[d-1]=arguments[d];for(d=[];0<a;)a&1&&d.push(c[0]||"ILLEGAL"),c.shift(),a<<=1;return d}
var Nsf$$module$nsf=function(a){var b=new DataView(a,0,128);if("NESM\u001a"!=getString$$module$nsf(b,0,5))throw Error("Invalid NSF file.");this.version_=b.getUint8(5);this.songCount_=b.getUint8(6);this.startSong_=b.getUint8(7);this.loadAddress_=b.getUint16(8,!0);this.initAddress_=b.getUint16(10,!0);this.playAddress_=b.getUint16(12,!0);this.songName_=getString$$module$nsf(b,14,32);this.artistName_=getString$$module$nsf(b,46,32);this.copyrightName_=getString$$module$nsf(b,78,32);this.playSpeedNtsc_=
b.getUint16(110,!0);this.bankInits_=new Uint8Array(a,112,8);this.playSpeedPal_=b.getUint16(120,!0);var c=b.getUint8(122);this.palNtsc_=c&2?"dual":c&1?"pal":"ntsc";this.extraSupport_=readBits$$module$nsf(b.getUint8(123),"VRC6","VRC7","FDS","MMC5","Namco 163","Sunsoft 5B");this.data_=new Uint8Array(a,128)};Nsf$$module$nsf.prototype.cyclesPerFrame=function(a){return Math.floor((a.ntsc?this.playSpeedNtsc_:this.playSpeedPal_)/1E6/a.cycleLength)};
Nsf$$module$nsf.prototype.init=function(a,b,c,d){c=void 0===c?null:c;d=void 0===d?null:d;b.zero();a.init();if(this.bankInits_.find(function(a){return a})){if(!d)throw Error("Bank switcher required for this ROM");d.load(this.data_,this.loadAddress_);d=0<=this.extraSupport_.indexOf("FDS");for(var e=0;8>e;e++)b.set(5<e&&d?24560+e:24568+e,this.bankInits_[e])}else b.load(this.data_,this.loadAddress_);a.pushWord(65535);a.pushWord(this.playAddress_-1);a.PC=this.initAddress_-1;b.set(16405,15);b.set(16407,
64);a.A=null!=c?c:this.startSong_;a.X="pal"!=this.palNtsc_?0:1};Nsf$$module$nsf.prototype.frame=function(a){a.pushWord(65535);a.PC=this.playAddress_-1};
Nsf$$module$nsf.prototype.toString=function(){var a=[];"ntsc"!=this.palNtsc_&&"dual"!=this.palNtsc_||a.push(1E6/this.playSpeedNtsc_+" Hz NTSC");"pal"!=this.palNtsc_&&"dual"!=this.palNtsc_||a.push(1E6/this.playSpeedPal_+" Hz PAL");return["NSF v"+this.version_,this.songCount_+" songs, starting at "+this.startSong_,"Load:      $"+this.loadAddress_.toString(16),"Init:      $"+this.initAddress_.toString(16),"Play:      $"+this.playAddress_.toString(16),"Song name: "+this.songName_,"Artist:    "+this.artistName_,
"Copyright: "+this.copyrightName_,"Speed:     "+a.join(" / "),"Bank Init: "+this.bankInits_.join(" "),"Extras:    "+this.extraSupport_.join(" ")].join("\n")};module$nsf.default=Nsf$$module$nsf;var module$nsfplayer={},NsfPlayer$$module$nsfplayer=function(a,b){this.nsf=b;this.clock=module$clock.default.ntsc();this.cyclesPerFrame=b.cyclesPerFrame(this.clock);this.mem=new module$mem.default(this.clock);this.apu=new module$apu$apu.default(this.mem,this.clock);this.cpu=new module$cpu.default(this.mem);this.banks=new module$bankswitcher.default(this.mem);this.node=new module$audio$bufferedaudionode.default(a,2);this.node.connect(a.destination);this.writer=new module$audio$stepbufferwriter.default(this.node);
this.promise=null;var c=document.getElementById("log");for(a=16384;16408>a;a++)this.mem.listen(a,function(a){var b="Frame "+60*this.clock.time+":";20>b.length&&(b+=" ".repeat(20-b.length));c&&(c.textContent+=b+" ("+a.toString(16)+") <= "+this.mem.get(a).toString(16)+"\n")}.bind(this,a))};
NsfPlayer$$module$nsfplayer.prototype.start=function(a){a=void 0===a?0:a;var b=document.getElementById("memlog");b&&(b.textContent="");this.nsf.init(this.cpu,this.mem,a,this.banks);this.node.reset();this.promise=null;this.play(null)};
NsfPlayer$$module$nsfplayer.prototype.play=function(a){var b=this;if(this.promise==a){0==this.node.bufferTime()&&console.log("buffer underrun!");for(var c=0;10>c;c++){for(var d=this.cyclesPerFrame;0<=d;d--){if(d!=d)throw Error("NaN");65535!=this.cpu.PC&&this.cpu.clock();this.apu.clock();this.clock.tick()}65535==this.cpu.PC?this.nsf.frame(this.cpu):this.cpu.log("LONG FRAME")}a=this.promise=this.writer.write(this.apu.steps(),this.clock.time).then(function(){setTimeout(function(){return b.play(a)},1E3*
b.node.bufferTime()-60)})}};NsfPlayer$$module$nsfplayer.prototype.stop=function(){this.promise=null};function readLocalFiles$$module$nsfplayer(){var a=document.getElementById("files").files[0],b=new FileReader;b.onload=function(a){return startEmu$$module$nsfplayer(a.target.result)};b.readAsArrayBuffer(a)}
function startEmu$$module$nsfplayer(a){a=new module$nsf.default(a);(new module$cpu.default(new module$mem.default)).log(a+"");var b=new AudioContext,c=new NsfPlayer$$module$nsfplayer(b,a);window.PLAYER=c;var d=2;c.start(d);a=document.getElementById("stop");b=document.getElementById("next");a.style.display="";b.style.display="";a.addEventListener("click",function(){return c.stop()});b.addEventListener("click",function(){return c.start(++d)})}
document.getElementById("fetch").addEventListener("click",readLocalFiles$$module$nsfplayer);module$nsfplayer.default=NsfPlayer$$module$nsfplayer;
//# sourceMappingURL=nes.compiled.srcmap
